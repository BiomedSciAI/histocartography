pipeline:
  inputs:
  - path
  - annotation_path
  stages:
    - io:
        class: ImageLoader
        inputs:
        - path
        outputs:
        - image
    - stain_normalizers:
        class: VahadaneStainNormalizer
        inputs:
        - image
        outputs:
        - normalized_image
        params:
          target: 18B0003896D
    - tissue_mask:
        class: HistomicstkTissueMask
        inputs:
        - normalized_image
        outputs:
        - tissue_mask
        params:
          downsampling_factor: 2
    - superpixel:
        class: ColorMergedSuperpixelExtractor
        inputs:
        - normalized_image
        outputs:
        - merged_superpixels
        - initial_superpixels
        - mapping
        params:
          downsampling_factor: 2
          compactness: 20
          blur_kernel_size: 3
          dynamic_superpixels: True
          nr_superpixels: 4000
          threshold: 0.01
    - feature_extraction:
        class: HandcraftedFeatureExtractor
        inputs:
        - normalized_image
        - merged_superpixels
        outputs:
        - merged_features
    - io:
        class: ImageLoader
        inputs:
        - annotation_path
        outputs:
        - annotation
    - tissue_mask:
        class: AnnotationPostProcessor
        inputs:
        - annotation
        - tissue_mask
        outputs:
        - processed_annotation
        params:
          background_index: 4
    - graph_builders:
        class: RAGGraphBuilder
        inputs:
        - merged_superpixels
        - merged_features
        - processed_annotation
        outputs:
        - graph
        params:
          nr_classes: 5
          background_class: 4
          partial_annotation: null
          hops: 1
    - stats:
        class: GraphDiameter
        inputs:
        - graph
        outputs:
        - graph_diameter
    - stats:
        class: SuperpixelCounter
        inputs:
        - merged_superpixels
        outputs:
        - nr_superpixels
params:
  dataset: sicapv2_wsi
  save: True
  cores: 4
  labels: True
  link_directory: v0_low_4000_handcrafted
  partial_annotation: null
