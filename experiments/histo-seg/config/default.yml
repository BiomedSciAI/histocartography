upper_bound:
  stages:
    stain_normalizer:
      class: "VahadaneStainNormalizer"
      params:
        target: "ZT111_4_C_7_1"
    superpixel_extractor:
      class: "SLICSuperpixelExtractor"
      params:
        nr_superpixels: 2000
        color_space: "rgb"
  params:
    cores: 16
train:
  data:
    overfit_test: False
    train_fraction: null
    training_slides:
      - 111
      - 199
      - 204
    validation_slides:
      - 76
    patch_size: null
    graph_directory:  "outputs/v3_900_19a9b40d174f40c4b217ddf84eb63e3b"
    tissue_mask_directory: "BrightnessThresholdTissueMask(blur_size=25,dilation_steps=5,erosion_steps=10,kernel_size=20)"
    centroid_features: "cat"
    use_patches_for_validation: false
    normalize_features: false
    downsample_segmentation_maps: 16
    use_augmentation_dataset: false
    augmentation_mode: null
  model:
    gnn_config:
      activation: "PReLU"
      agg_operator: "concat"
      input_dim: 1282
      hidden_dim: 32
      layer_type: "gin_layer"
      n_layers: 4
      output_dim: 32
      neighbor_pooling_type: "mean"
      graph_norm: False
      with_rlp: False
      edge_dim: null
      dropout: 0.0
    graph_classifier_config:
      n_layers: 2
      hidden_dim: 32
    node_classifier_config:
      n_layers: 1
      hidden_dim: 32
      activation: "PReLU"
      input_dropout: 0.0
      seperate_heads: True
  metrics:
    graph:
      - "GraphClassificationBalancedAccuracy"
      - "GraphClassificationF1Score"
      - "GraphClassificationAUCROC"
      - "GraphClassificationBenignAccuracy"
      - "GraphClassificationGleason3Accuracy"
      - "GraphClassificationGleason4Accuracy"
      - "GraphClassificationGleason5Accuracy"
    node:
      - "NodeClassificationAccuracy"
      - "NodeClassificationBalancedAccuracy"
      - "NodeClassificationF1Score"
    segmentation:
      - "MeanIoU"
      - "fIoU"
      - "MeanF1Score"
  params:
    experiment_name: "anv_wsss_train_classifier"
    experiment_tags: null
    optimizer:
      class: "Adam"
      params:
        lr: 0.00003
      scheduler: null
    loss:
      graph:
        class: "GraphBCELoss"
      node:
        class: "NodeStochasticCrossEntropy"
        params:
          background_label: 4
          drop_probability: 0.0
      node_weight: 0.5
    batch_size: 8
    nr_epochs: 500
    num_workers: 8
    clip_gradient_norm: null
    dataset: "eth"
    seed: null
    validation_frequency: 5
test:
  data:
    use_augmentation_dataset: True
    tissue_mask_directory: "BrightnessThresholdTissueMask(blur_size=25,dilation_steps=5,erosion_steps=10,kernel_size=20)"
  model:
    architecture: 's3://mlflow/631/8956fc6facf14bfa8117723df6be87e6/artifacts/best.valid.segmentation.MeanIoU'
  params:
    experiment_name: "anv_wsss_test_gnn"
    experiment_tags: null
    dataset: eth
    operation: argmax
    local_save_path: '/dataP/anv/data/ETH/gnn_test_masks'
    mlflow_save_path: 'gnn_test_masks'
    threshold: 0.25
